<?xml version="1.0" encoding="UTF-8"?>
<Configuration status="WARN" monitorInterval="30">
    <Properties>
        <!-- 로그 출력 패턴 -->
        <Property name="LOG_PATTERN">%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%t] %c{1} - %msg%n</Property>
        <!-- 로그 디렉터리: 시스템 프로퍼티 LOG_DIR가 있으면 사용, 없으면 프로젝트 상대의 logs 폴더 사용 -->
        <Property name="LOG_DIR">${sys:LOG_DIR:-logs}</Property>
    </Properties>

    <Appenders>
        <!-- 콘솔 출력 -->
        <Console name="Console" target="SYSTEM_OUT">
            <!-- 콘솔에서는 레벨에 색상을 적용 (ANSI). 패키지 경로는 각 요소를 한 글자씩 표시하고 마지막 클래스명은 전체 표시 -->
            <PatternLayout pattern="%d{yyyy-MM-dd HH:mm:ss.SSS} %highlight{[%-5level]} [%t] %c{1.} - %msg%n" disableAnsi="false"/>
        </Console>

        <!-- 일별 롤링 파일: 매일 자정에 롤링 (modulate=true 사용) -->
        <RollingFile name="RollingFile"
                    fileName="${LOG_DIR}/app.log"
                    filePattern="${LOG_DIR}/app-%d{yyyy-MM-dd}.log.gz">
            <PatternLayout pattern="${LOG_PATTERN}"/>
            <Policies>
                <!-- Time based policy: interval=1, modulate=true -> 자정 기준 롤링 -->
                <TimeBasedTriggeringPolicy interval="1" modulate="true"/>
            </Policies>
            <DefaultRolloverStrategy max="30"/>
        </RollingFile>
    </Appenders>

    <!--
        Spring 프로파일 별 로거 설정
        - dev, test: dev.retrotv -> DEBUG, 나머지 -> WARN
        - prod: dev.retrotv -> INFO, 나머지 -> WARN
        log4j2-spring.xml 파일은 Spring Boot에서 `log4j2` 확장으로 Spring 프로파일을 지원합니다.
    -->

    <!-- dev 및 test 프로파일 설정 -->
    <SpringProfile name="dev,test">
        <Loggers>
            <!-- 패키지별 로그: dev.retrotv는 DEBUG -->
            <Logger name="dev.retrotv" level="debug" additivity="false">
                <AppenderRef ref="Console"/>
                <AppenderRef ref="RollingFile"/>
            </Logger>

            <!-- 기타는 기본적으로 WARN -->
            <Root level="warn">
                <AppenderRef ref="Console"/>
                <AppenderRef ref="RollingFile"/>
            </Root>
        </Loggers>
    </SpringProfile>

    <!-- prod 프로파일 설정 -->
    <SpringProfile name="prod">
        <Loggers>
            <!-- dev.retrotv는 INFO -->
            <Logger name="dev.retrotv" level="info" additivity="false">
                <AppenderRef ref="Console"/>
                <AppenderRef ref="RollingFile"/>
            </Logger>

            <!-- 기타는 WARN -->
            <Root level="warn">
                <AppenderRef ref="Console"/>
                <AppenderRef ref="RollingFile"/>
            </Root>
        </Loggers>
    </SpringProfile>
</Configuration>
